ğŸ® åœ¨å¼•æ“ä¸­ä½¿ç”¨æ–°ç³»ç»Ÿ

  1. åŸºç¡€ä½¿ç”¨æ–¹å¼

  æ–¹æ³•ä¸€ï¼šä½¿ç”¨ VoxelSystemExampleï¼ˆæ¨èæ–°æ‰‹ï¼‰

  åœ¨åœºæ™¯ä¸­åˆ›å»ºä¸€ä¸ªç©ºèŠ‚ç‚¹ï¼Œæ·»åŠ  VoxelSystemExample ç»„ä»¶ï¼š

  // åœ¨åœºæ™¯èŠ‚ç‚¹ä¸Šç›´æ¥æ·»åŠ ç»„ä»¶
  // ç»„ä»¶ä¼šè‡ªåŠ¨åˆå§‹åŒ–å¹¶æ˜¾ç¤ºæµ‹è¯•æ–¹å—

  æ–¹æ³•äºŒï¼šè‡ªå®šä¹‰ä½¿ç”¨ VoxelSystem

  import { _decorator, Component, Node, Vec3, Camera } from 'cc';
  import { VoxelSystem } from 'assets/scripts/voxel';

  const { ccclass, property } = _decorator;

  @ccclass('MyVoxelScene')
  export class MyVoxelScene extends Component {
      @property(Node)
      containerNode: Node = null;

      @property(Camera)
      camera: Camera = null;

      async start() {
          // åˆå§‹åŒ–ä½“ç´ ç³»ç»Ÿ
          const voxelSystem = await VoxelSystem.quickInitialize();
          if (!voxelSystem) {
              console.error('ä½“ç´ ç³»ç»Ÿåˆå§‹åŒ–å¤±è´¥');
              return;
          }

          // åˆ›å»ºä¸€äº›æµ‹è¯•æ–¹å—
          await this.createTestBlocks(voxelSystem);
      }

      private async createTestBlocks(voxelSystem: VoxelSystem) {
          // åˆ›å»ºçŸ³å¤´æ–¹å—
          const stoneMesh = await voxelSystem.generateBlockMesh(
              'minecraft:stone',
              new Vec3(0, 0, 0)
          );

          // åˆ›å»ºæè´¨
          const stoneMaterial = await voxelSystem.createBlockMaterial('minecraft:stone');

          // æ·»åŠ åˆ°åœºæ™¯ï¼ˆéœ€è¦è‡ªå·±å®ç°ç½‘æ ¼æ¸²æŸ“é€»è¾‘ï¼‰
          this.addMeshToScene(stoneMesh, stoneMaterial);
      }
  }

  2. ä½¿ç”¨äº¤äº’ç³»ç»Ÿ

  import { VoxelInteractionManager, VoxelCameraMode } from 'assets/scripts/voxel';

  @ccclass('InteractiveVoxelScene')
  export class InteractiveVoxelScene extends Component {
      @property(VoxelInteractionManager)
      interactionManager: VoxelInteractionManager = null;

      start() {
          // è®¾ç½®äº¤äº’äº‹ä»¶
          this.interactionManager.setEvents({
              onBlockClick: (hitResult) => {
                  console.log('ç‚¹å‡»äº†æ–¹å—:', hitResult);
              },
              onBlockPlace: (position, blockType) => {
                  console.log('æ”¾ç½®æ–¹å—:', position, blockType);
              },
              onBlockBreak: (position) => {
                  console.log('ç ´åæ–¹å—:', position);
              }
          });

          // åˆ‡æ¢ç›¸æœºæ¨¡å¼
          this.interactionManager.setCameraMode(VoxelCameraMode.WALKING);
      }

      // æ‰‹åŠ¨æ”¾ç½®æ–¹å—
      placeStone() {
          this.interactionManager.placeBlock(
              new Vec3(1, 0, 1),
              VoxelBlockType.STONE
          );
      }
  }

  ğŸ§ª æµ‹è¯•æ­¥éª¤

  æ­¥éª¤ 1ï¼šåˆ›å»ºæµ‹è¯•åœºæ™¯

  1. åœ¨ Cocos Creator ä¸­åˆ›å»ºæ–°åœºæ™¯
  2. åˆ›å»ºä¸€ä¸ªç©ºçš„ Nodeï¼Œå‘½åä¸º "VoxelContainer"
  3. åœ¨è¯¥èŠ‚ç‚¹ä¸Šæ·»åŠ  VoxelSystemExample ç»„ä»¶
  4. ç¡®ä¿åœºæ™¯ä¸­æœ‰ Camera èŠ‚ç‚¹

  æ­¥éª¤ 2ï¼šé…ç½®ç»„ä»¶

  åœ¨ Inspector é¢æ¿ä¸­ï¼š
  - VoxelSystemExample:
    - Container Node: æ‹–å…¥ VoxelContainer èŠ‚ç‚¹
    - Camera: æ‹–å…¥åœºæ™¯ç›¸æœº

  æ­¥éª¤ 3ï¼šè¿è¡Œæµ‹è¯•

  ç‚¹å‡»æ’­æ”¾æŒ‰é’®ï¼Œä½ åº”è¯¥çœ‹åˆ°ï¼š
  - æ§åˆ¶å°è¾“å‡ºç³»ç»Ÿåˆå§‹åŒ–ä¿¡æ¯
  - åœºæ™¯ä¸­æ˜¾ç¤ºå„ç§æµ‹è¯•æ–¹å—ï¼š
    - çŸ³å¤´ã€æ³¥åœŸã€è‰æ–¹å—ï¼ˆcube_allï¼‰
    - æ©¡æœ¨åŸæœ¨ã€æœ¨æ¿ï¼ˆcube_columnï¼‰
    - ç»ç’ƒæ–¹å—ï¼ˆé€æ˜ï¼‰
    - è’²å…¬è‹±ã€è™ç¾äººç­‰æ¤ç‰©ï¼ˆcross äº¤å‰æ¨¡å‹ï¼‰

  æ­¥éª¤ 4ï¼šæ·»åŠ äº¤äº’åŠŸèƒ½

  å¦‚æœæƒ³è¦é¼ æ ‡äº¤äº’ï¼š

  1. åœ¨åŒä¸€èŠ‚ç‚¹æ·»åŠ  VoxelInteractionManager ç»„ä»¶
  2. åœ¨ Inspector ä¸­è®¾ç½®ï¼š
    - Camera: æ‹–å…¥åœºæ™¯ç›¸æœº
    - Enable Debug Visualization: å‹¾é€‰ï¼ˆæ˜¾ç¤ºå°„çº¿è°ƒè¯•ï¼‰
    - Enable Hit Markers: å‹¾é€‰ï¼ˆæ˜¾ç¤ºå‡»ä¸­ç‚¹æ ‡è®°ï¼‰

  ğŸ¯ å®Œæ•´æµ‹è¯•ç»„ä»¶ç¤ºä¾‹

  import { _decorator, Component, Node, Vec3, Camera } from 'cc';
  import { VoxelSystem, VoxelInteractionManager, VoxelCameraMode, VoxelBlockType } from 'assets/scripts/voxel';

  const { ccclass, property } = _decorator;

  @ccclass('CompleteVoxelTest')
  export class CompleteVoxelTest extends Component {
      @property(Node)
      containerNode: Node = null;

      @property(Camera)
      camera: Camera = null;

      @property(VoxelInteractionManager)
      interactionManager: VoxelInteractionManager = null;

      private voxelSystem: VoxelSystem = null;

      async start() {
          console.log('[CompleteVoxelTest] å¼€å§‹æµ‹è¯•å®Œæ•´ä½“ç´ ç³»ç»Ÿ');

          // 1. åˆå§‹åŒ–ä½“ç´ ç³»ç»Ÿ
          this.voxelSystem = await VoxelSystem.quickInitialize();
          if (!this.voxelSystem) {
              console.error('ä½“ç´ ç³»ç»Ÿåˆå§‹åŒ–å¤±è´¥');
              return;
          }

          // 2. æ˜¾ç¤ºç³»ç»Ÿä¿¡æ¯
          this.voxelSystem.logSystemStats();

          // 3. åˆ›å»ºæµ‹è¯•æ–¹å—
          await this.createTestBlocks();

          // 4. è®¾ç½®äº¤äº’ç³»ç»Ÿ
          this.setupInteraction();

          console.log('[CompleteVoxelTest] å®Œæ•´æµ‹è¯•åœºæ™¯å‡†å¤‡å°±ç»ª');
          console.log('- å·¦é”®ç‚¹å‡»ï¼šç ´åæ–¹å—');
          console.log('- å³é”®ç‚¹å‡»ï¼šæ”¾ç½®æ–¹å—');
          console.log('- å¯ç”¨æ–¹å—ç±»å‹:', this.voxelSystem.getAllBlockIds());
      }

      private async createTestBlocks() {
          const blocks = [
              { id: 'minecraft:stone', pos: new Vec3(0, 0, 0) },
              { id: 'minecraft:oak_log', pos: new Vec3(1, 0, 0) },
              { id: 'minecraft:glass', pos: new Vec3(2, 0, 0) },
              { id: 'minecraft:dandelion', pos: new Vec3(0, 1, 0) }
          ];

          for (const block of blocks) {
              const meshData = await this.voxelSystem.generateBlockMesh(block.id, block.pos);
              const material = await this.voxelSystem.createBlockMaterial(block.id);

              // è¿™é‡Œéœ€è¦ä½ è‡ªå·±å®ç°å°†ç½‘æ ¼æ·»åŠ åˆ°åœºæ™¯çš„é€»è¾‘
              // æˆ–è€…ç›´æ¥ä½¿ç”¨ VoxelSystemExample ç»„ä»¶
              console.log(`åˆ›å»ºæ–¹å—: ${block.id} åœ¨ä½ç½® ${block.pos}`);
          }
      }

      private setupInteraction() {
          if (!this.interactionManager) return;

          this.interactionManager.setEvents({
              onBlockClick: (hitResult) => {
                  console.log('ğŸ¯ å‡»ä¸­æ–¹å—:', hitResult.position);
              },
              onBlockPlace: (position, blockType) => {
                  console.log('ğŸ“¦ æ”¾ç½®æ–¹å—:', position, blockType);
              },
              onBlockBreak: (position) => {
                  console.log('ğŸ’¥ ç ´åæ–¹å—:', position);
              },
              onModeChange: (mode) => {
                  console.log('ğŸ“· ç›¸æœºæ¨¡å¼åˆ‡æ¢:', mode);
              }
          });

          // è®¾ç½®é»˜è®¤æ–¹å—ç±»å‹
          this.interactionManager.setSelectedBlockType(VoxelBlockType.STONE);
      }

      // æµ‹è¯•æ–¹æ³•ï¼šåŠ¨æ€æ·»åŠ æ–¹å—
      public async addRandomBlock() {
          if (!this.voxelSystem) return;

          const blockIds = this.voxelSystem.getAllBlockIds();
          const randomId = blockIds[Math.floor(Math.random() * blockIds.length)];
          const randomPos = new Vec3(
              Math.floor(Math.random() * 10) - 5,
              Math.floor(Math.random() * 3),
              Math.floor(Math.random() * 10) - 5
          );

          await this.voxelSystem.generateBlockMesh(randomId, randomPos);
          console.log(`éšæœºæ·»åŠ æ–¹å—: ${randomId} åœ¨ ${randomPos}`);
      }

      // æµ‹è¯•æ–¹æ³•ï¼šåˆ‡æ¢ç›¸æœºæ¨¡å¼
      public toggleCameraMode() {
          if (this.interactionManager) {
              this.interactionManager.toggleCameraMode();
          }
      }
  }

  ğŸ” è°ƒè¯•ä¿¡æ¯

  è¿è¡Œæ—¶æŸ¥çœ‹æ§åˆ¶å°ï¼Œä½ ä¼šçœ‹åˆ°è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯ï¼š

  [VoxelSystem] å¼€å§‹åˆå§‹åŒ–ä½“ç´ æ¸²æŸ“ç³»ç»Ÿ...
  [ResourcePackLoader] å¼€å§‹åŠ è½½èµ„æºåŒ…: voxel/default
  [TextureManager] åˆå§‹åŒ–çº¹ç†ç®¡ç†å™¨...
  [VoxelSystem] ä½“ç´ ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ
  [VoxelSystem] ç³»ç»Ÿç»Ÿè®¡:
  - æ–¹å—ç±»å‹: 13
  - çº¹ç†ç¼“å­˜: 15 (15 å·²åŠ è½½)
  - æè´¨ç¼“å­˜: 8
  - æ¨¡å‹ç¼“å­˜: 12

  âš¡ å¿«é€Ÿæµ‹è¯•æŒ‡ä»¤

  æœ€ç®€å•çš„æµ‹è¯•æ–¹æ³•ï¼š

  1. åˆ›å»ºç©ºèŠ‚ç‚¹
  2. æ·»åŠ  VoxelSystemExample ç»„ä»¶
  3. ç‚¹å‡»æ’­æ”¾
  4. æŸ¥çœ‹æ§åˆ¶å°å’Œåœºæ™¯æ•ˆæœ

  è¿™æ ·ä½ å°±å¯ä»¥ç«‹å³çœ‹åˆ°æ–°çš„ Minecraft èµ„æºåŒ…æ¸²æŸ“ç³»ç»Ÿçš„æ•ˆæœäº†ï¼