å…¨éƒ¨å®Œæˆçš„å®ç°

  ğŸ“ æ–°å»ºæ–‡ä»¶

  1. MapTemplateConverter.ts
  - convertMapTemplateToSaveData(template, game, mapId) - æ ¸å¿ƒè½¬æ¢å‡½æ•°
  - getTileBlockId(kind) - TileKind â†’ blockId æ˜ å°„
  - getBuildingBlockId(size, buildingType) - BuildingSize â†’ blockId æ˜ å°„

  2. IdFormatter.tsï¼ˆä¹‹å‰å·²å®Œæˆï¼‰
  - shortenAddress(address) - åœ°å€ç¼©çŸ­å·¥å…·

  ğŸ”§ ä¿®æ”¹çš„æ–‡ä»¶

  1. SuiManager.tsï¼ˆæ–°å¢ 6 ä¸ªæ–¹æ³•ï¼‰
  - âœ… getMapTemplate(templateId) - æŸ¥è¯¢é“¾ä¸Š MapTemplate
  - âœ… _parseMapTemplateObject(fields) - è§£æ MapTemplate æ•°æ®
  - âœ… _loadGameScene(gameId) - åŠ è½½æ¸¸æˆåœºæ™¯
  - âœ… _addNewGameToCache(gameId) - ä¼˜åŒ–æ¸¸æˆç¼“å­˜ï¼ˆæ›¿ä»£ _refreshGamesCacheï¼‰
  - âœ… _onPlayerJoined(event) - å¢é‡æ›´æ–°ç©å®¶åˆ—è¡¨
  - âœ… _onGameStarted(event) - é‡æ„ï¼ˆåˆ¤æ–­ç©å®¶/éç©å®¶åˆ†åˆ«å¤„ç†ï¼‰

  2. GameMap.tsï¼ˆæ–°å¢ 2 ä¸ªæ–¹æ³•ï¼‰
  - âœ… loadFromChainData(template, game) - ä»é“¾ä¸Šæ•°æ®åŠ è½½åœºæ™¯
  - âœ… _loadMapFromData(mapData) - ä»å†…å­˜æ•°æ®åŠ è½½ï¼ˆå†…éƒ¨æ–¹æ³•ï¼‰

  3. UIInGame.tsï¼ˆæ–°å¢ 2 ä¸ªæ–¹æ³•ï¼‰
  - âœ… _onGameStart(data) - ç›‘å¬æ¸¸æˆå¼€å§‹äº‹ä»¶
  - âœ… _initializeGameState(game, gameData) - åˆå§‹åŒ– Blackboard
  - âœ… æ·»åŠ  Game.GameStart äº‹ä»¶ç›‘å¬å’Œè§£ç»‘

  4. UIGameDetail.ts
  - âœ… _handleStartGame - æ·»åŠ æˆåŠŸ/å¤±è´¥ MessageBox
  - âœ… _handleJoinGame - æ·»åŠ æˆåŠŸ/å¤±è´¥ MessageBox
  - âœ… åŠ¨æ€æŒ‰é’®é€»è¾‘ï¼ˆå¼€å§‹æ¸¸æˆ/åŠ å…¥æ¸¸æˆ/å·²æ»¡å‘˜ï¼‰
  - âœ… ç›‘å¬ Move.PlayerJoined äº‹ä»¶è‡ªåŠ¨åˆ·æ–°

  5. UIGameList.ts
  - âœ… selectGameById(gameId) - æ ¹æ® ID é€‰ä¸­æ¸¸æˆ
  - âœ… _showGameDetail(game) - è§¦å‘è¯¦æƒ…æ˜¾ç¤º
  - âœ… refresh() - ä¿æŒé€‰ä¸­çŠ¶æ€
  - âœ… ç›‘å¬ Sui.GamesListUpdated äº‹ä»¶

  6. UIMapSelect.ts
  - âœ… showGameDetail(gameId) - ç»Ÿä¸€è¯¦æƒ…æ˜¾ç¤ºé€»è¾‘
  - âœ… _onMoveGameCreated - ä½¿ç”¨ eventData.gameObject
  - âœ… ç§»é™¤å­æ¨¡å—çš„ enabled åˆ‡æ¢
  - âœ… ç›‘å¬ Game.ShowGameDetail äº‹ä»¶

  7. QueryService.ts
  - âœ… parseID() - è§£æ ID ç±»å‹
  - âœ… parseOption() - è§£æ Option ç±»å‹
  - âœ… parsePlayers() - è¿”å› Player[] ç±»å‹

  8. game.tsï¼ˆinteractionsï¼‰
  - âœ… buildJoinGameTx - ä¿®å¤ PTB æ„å»ºé”™è¯¯
  - âœ… parsePlayers() - è¿”å› Player[] ç±»å‹
  - âœ… åˆ é™¤æ‰€æœ‰åºŸå¼ƒçš„ async æ–¹æ³•

  9. EventTypes.ts
  - âœ… æ·»åŠ  Game.ShowGameDetail äº‹ä»¶
  - âœ… ç¡®è®¤ Move.PlayerJoined äº‹ä»¶å·²å­˜åœ¨

  å®Œæ•´çš„æ•°æ®æµ

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                    åˆ›å»ºæ¸¸æˆæµç¨‹                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  ç©å®¶ç‚¹å‡»"åˆ›å»ºæ¸¸æˆ"
    â†“
  SuiManager.createGame()
    â†“
  é“¾ä¸Š GameCreatedEvent
    â†“
  SuiManager._addNewGameToCache() (åªæŸ¥è¯¢ 1 ä¸ª)
    â”œâ†’ è®¾ç½® _currentGame (åˆ›å»ºè€…)
    â””â†’ emit Move.GameCreated { gameObject }
        â†“
        UIMapSelect.showGameDetail()
          â”œâ†’ data å¯è§ + controller=0
          â””â†’ GameDetail æ˜¾ç¤º

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                    åŠ å…¥æ¸¸æˆæµç¨‹                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  ç©å®¶ç‚¹å‡»"åŠ å…¥æ¸¸æˆ"
    â†“
  SuiManager.joinGame()
    â†“
  é“¾ä¸Š PlayerJoinedEvent
    â†“
  SuiManager._onPlayerJoined() (å¢é‡æ›´æ–°)
    â”œâ†’ åˆ›å»ºæ–° Player æ·»åŠ åˆ° game.players
    â”œâ†’ æ›´æ–° _currentGame
    â””â†’ emit Sui.GamesListUpdated + Move.PlayerJoined
        â†“
        â”œâ†’ UIGameList.refresh() (ä¿æŒé€‰ä¸­)
        â””â†’ UIGameDetail.showGame() (æ›´æ–°æŒ‰é’®çŠ¶æ€)

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                    å¼€å§‹æ¸¸æˆæµç¨‹                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  ç©å®¶ç‚¹å‡»"å¼€å§‹æ¸¸æˆ"
    â†“
  SuiManager.startGame()
    â†“
  é“¾ä¸Š GameStartedEvent
    â†“
  SuiManager._onGameStarted()
    â”œâ†’ æ˜¯ç©å®¶ï¼Ÿ
    â”‚   âœ“ Yes â†’ _loadGameScene()
    â”‚             â”œâ†’ æŸ¥è¯¢ Game + MapTemplate + GameData
    â”‚             â”œâ†’ è®¾ç½® _currentGame
    â”‚             â””â†’ emit Game.GameStart { game, template, gameData }
    â”‚                   â†“
    â”‚                   UIInGame._onGameStart()
    â”‚                     â”œâ†’ show UIInGame
    â”‚                     â”œâ†’ hide UIMapSelect
    â”‚                     â”œâ†’ GameMap.loadFromChainData()
    â”‚                     â”‚     â†“
    â”‚                     â”‚     MapTemplateConverter.convert()
    â”‚                     â”‚     â†“
    â”‚                     â”‚     GameMap._loadMapFromData()
    â”‚                     â”‚     â†“
    â”‚                     â”‚     æ¸²æŸ“ 3D åœºæ™¯
    â”‚                     â””â†’ åˆå§‹åŒ– Blackboard
    â”‚
    â””â”€â†’ ä¸æ˜¯ç©å®¶ï¼Ÿ
        âœ“ Yes â†’ æ›´æ–° status
                ç§»å‡º READY åˆ—è¡¨

  å…³é”®ä¼˜åŒ–ç‚¹

  1. âœ… GameCreatedï¼šä»æŸ¥è¯¢ 50 ä¸ªæ¸¸æˆ â†’ åªæŸ¥è¯¢ 1 ä¸ªæ–°æ¸¸æˆ
  2. âœ… PlayerJoinedï¼šå¢é‡æ›´æ–°ï¼Œä¸é‡æ–°æŸ¥è¯¢å®Œæ•´ Game
  3. âœ… GameStartedï¼šåŒºåˆ†ç©å®¶/è§‚å¯Ÿè€…ï¼Œç©å®¶æ‰åŠ è½½åœºæ™¯
  4. âœ… åœºæ™¯åŠ è½½ï¼šå¤ç”¨ç°æœ‰ GameMap é€»è¾‘ï¼Œé€šè¿‡æ•°æ®è½¬æ¢å®ç°
  5. âœ… UI å“åº”å¼ï¼šæ‰€æœ‰åˆ—è¡¨å’Œè¯¦æƒ…éƒ½å®æ—¶æ›´æ–°

  å¯ä»¥æµ‹è¯•äº†ï¼

  ç°åœ¨å®Œæ•´çš„"åˆ›å»ºæ¸¸æˆ â†’ åŠ å…¥æ¸¸æˆ â†’ å¼€å§‹æ¸¸æˆ â†’ åŠ è½½åœºæ™¯"æµç¨‹å·²å…¨éƒ¨å®ç°ï¼Œå¯ä»¥åœ¨å®¢æˆ·ç«¯æµ‹è¯•äº†



 å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼š
  - âœ… å¸è½½æ—§åœºæ™¯
  - âœ… åˆ›å»ºæ–°å®ä¾‹
  - âœ… åˆå§‹åŒ–ç»„ä»¶
  - âœ… åŠ è½½æ•°æ®
  - âœ… æ·»åŠ åˆ°åœºæ™¯æ ‘
  - âœ… æ›´æ–°çŠ¶æ€


  | æ­¥éª¤    | ç¼–è¾‘åœ°å›¾                    | å¼€å§‹æ¸¸æˆï¼ˆä¿®å¤åï¼‰                         |
  |-------|-------------------------|-----------------------------------|
  | å¸è½½æ—§åœºæ™¯ | âœ… unloadCurrentMap()    | âœ… unloadCurrentMap()              |
  | åˆ›å»ºèŠ‚ç‚¹  | âœ… new Node()            | âœ… new Node()                      |
  | æ·»åŠ ç»„ä»¶  | âœ… addComponent(GameMap) | âœ… addComponent(GameMap)           |
  | åˆå§‹åŒ–   | âœ… init(config, true)    | âœ… init(tempConfig, false)         |
  | åŠ è½½æ•°æ®  | loadMap(mapId)          | loadFromChainData(template, game) |
  | æ·»åŠ åˆ°åœºæ™¯ | âœ… container.addChild()  | âœ… container.addChild()            |
  | æ›´æ–°çŠ¶æ€  | âœ… _currentMapInstance   | âœ… _currentMapInstance             |