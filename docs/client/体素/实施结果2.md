🎮 在引擎中使用新系统

  1. 基础使用方式

  方法一：使用 VoxelSystemExample（推荐新手）

  在场景中创建一个空节点，添加 VoxelSystemExample 组件：

  // 在场景节点上直接添加组件
  // 组件会自动初始化并显示测试方块

  方法二：自定义使用 VoxelSystem

  import { _decorator, Component, Node, Vec3, Camera } from 'cc';
  import { VoxelSystem } from 'assets/scripts/voxel';

  const { ccclass, property } = _decorator;

  @ccclass('MyVoxelScene')
  export class MyVoxelScene extends Component {
      @property(Node)
      containerNode: Node = null;

      @property(Camera)
      camera: Camera = null;

      async start() {
          // 初始化体素系统
          const voxelSystem = await VoxelSystem.quickInitialize();
          if (!voxelSystem) {
              console.error('体素系统初始化失败');
              return;
          }

          // 创建一些测试方块
          await this.createTestBlocks(voxelSystem);
      }

      private async createTestBlocks(voxelSystem: VoxelSystem) {
          // 创建石头方块
          const stoneMesh = await voxelSystem.generateBlockMesh(
              'minecraft:stone',
              new Vec3(0, 0, 0)
          );

          // 创建材质
          const stoneMaterial = await voxelSystem.createBlockMaterial('minecraft:stone');

          // 添加到场景（需要自己实现网格渲染逻辑）
          this.addMeshToScene(stoneMesh, stoneMaterial);
      }
  }

  2. 使用交互系统

  import { VoxelInteractionManager, VoxelCameraMode } from 'assets/scripts/voxel';

  @ccclass('InteractiveVoxelScene')
  export class InteractiveVoxelScene extends Component {
      @property(VoxelInteractionManager)
      interactionManager: VoxelInteractionManager = null;

      start() {
          // 设置交互事件
          this.interactionManager.setEvents({
              onBlockClick: (hitResult) => {
                  console.log('点击了方块:', hitResult);
              },
              onBlockPlace: (position, blockType) => {
                  console.log('放置方块:', position, blockType);
              },
              onBlockBreak: (position) => {
                  console.log('破坏方块:', position);
              }
          });

          // 切换相机模式
          this.interactionManager.setCameraMode(VoxelCameraMode.WALKING);
      }

      // 手动放置方块
      placeStone() {
          this.interactionManager.placeBlock(
              new Vec3(1, 0, 1),
              VoxelBlockType.STONE
          );
      }
  }

  🧪 测试步骤

  步骤 1：创建测试场景

  1. 在 Cocos Creator 中创建新场景
  2. 创建一个空的 Node，命名为 "VoxelContainer"
  3. 在该节点上添加 VoxelSystemExample 组件
  4. 确保场景中有 Camera 节点

  步骤 2：配置组件

  在 Inspector 面板中：
  - VoxelSystemExample:
    - Container Node: 拖入 VoxelContainer 节点
    - Camera: 拖入场景相机

  步骤 3：运行测试

  点击播放按钮，你应该看到：
  - 控制台输出系统初始化信息
  - 场景中显示各种测试方块：
    - 石头、泥土、草方块（cube_all）
    - 橡木原木、木板（cube_column）
    - 玻璃方块（透明）
    - 蒲公英、虞美人等植物（cross 交叉模型）

  步骤 4：添加交互功能

  如果想要鼠标交互：

  1. 在同一节点添加 VoxelInteractionManager 组件
  2. 在 Inspector 中设置：
    - Camera: 拖入场景相机
    - Enable Debug Visualization: 勾选（显示射线调试）
    - Enable Hit Markers: 勾选（显示击中点标记）

  🎯 完整测试组件示例

  import { _decorator, Component, Node, Vec3, Camera } from 'cc';
  import { VoxelSystem, VoxelInteractionManager, VoxelCameraMode, VoxelBlockType } from 'assets/scripts/voxel';

  const { ccclass, property } = _decorator;

  @ccclass('CompleteVoxelTest')
  export class CompleteVoxelTest extends Component {
      @property(Node)
      containerNode: Node = null;

      @property(Camera)
      camera: Camera = null;

      @property(VoxelInteractionManager)
      interactionManager: VoxelInteractionManager = null;

      private voxelSystem: VoxelSystem = null;

      async start() {
          console.log('[CompleteVoxelTest] 开始测试完整体素系统');

          // 1. 初始化体素系统
          this.voxelSystem = await VoxelSystem.quickInitialize();
          if (!this.voxelSystem) {
              console.error('体素系统初始化失败');
              return;
          }

          // 2. 显示系统信息
          this.voxelSystem.logSystemStats();

          // 3. 创建测试方块
          await this.createTestBlocks();

          // 4. 设置交互系统
          this.setupInteraction();

          console.log('[CompleteVoxelTest] 完整测试场景准备就绪');
          console.log('- 左键点击：破坏方块');
          console.log('- 右键点击：放置方块');
          console.log('- 可用方块类型:', this.voxelSystem.getAllBlockIds());
      }

      private async createTestBlocks() {
          const blocks = [
              { id: 'minecraft:stone', pos: new Vec3(0, 0, 0) },
              { id: 'minecraft:oak_log', pos: new Vec3(1, 0, 0) },
              { id: 'minecraft:glass', pos: new Vec3(2, 0, 0) },
              { id: 'minecraft:dandelion', pos: new Vec3(0, 1, 0) }
          ];

          for (const block of blocks) {
              const meshData = await this.voxelSystem.generateBlockMesh(block.id, block.pos);
              const material = await this.voxelSystem.createBlockMaterial(block.id);

              // 这里需要你自己实现将网格添加到场景的逻辑
              // 或者直接使用 VoxelSystemExample 组件
              console.log(`创建方块: ${block.id} 在位置 ${block.pos}`);
          }
      }

      private setupInteraction() {
          if (!this.interactionManager) return;

          this.interactionManager.setEvents({
              onBlockClick: (hitResult) => {
                  console.log('🎯 击中方块:', hitResult.position);
              },
              onBlockPlace: (position, blockType) => {
                  console.log('📦 放置方块:', position, blockType);
              },
              onBlockBreak: (position) => {
                  console.log('💥 破坏方块:', position);
              },
              onModeChange: (mode) => {
                  console.log('📷 相机模式切换:', mode);
              }
          });

          // 设置默认方块类型
          this.interactionManager.setSelectedBlockType(VoxelBlockType.STONE);
      }

      // 测试方法：动态添加方块
      public async addRandomBlock() {
          if (!this.voxelSystem) return;

          const blockIds = this.voxelSystem.getAllBlockIds();
          const randomId = blockIds[Math.floor(Math.random() * blockIds.length)];
          const randomPos = new Vec3(
              Math.floor(Math.random() * 10) - 5,
              Math.floor(Math.random() * 3),
              Math.floor(Math.random() * 10) - 5
          );

          await this.voxelSystem.generateBlockMesh(randomId, randomPos);
          console.log(`随机添加方块: ${randomId} 在 ${randomPos}`);
      }

      // 测试方法：切换相机模式
      public toggleCameraMode() {
          if (this.interactionManager) {
              this.interactionManager.toggleCameraMode();
          }
      }
  }

  🔍 调试信息

  运行时查看控制台，你会看到详细的调试信息：

  [VoxelSystem] 开始初始化体素渲染系统...
  [ResourcePackLoader] 开始加载资源包: voxel/default
  [TextureManager] 初始化纹理管理器...
  [VoxelSystem] 体素系统初始化完成
  [VoxelSystem] 系统统计:
  - 方块类型: 13
  - 纹理缓存: 15 (15 已加载)
  - 材质缓存: 8
  - 模型缓存: 12

  ⚡ 快速测试指令

  最简单的测试方法：

  1. 创建空节点
  2. 添加 VoxelSystemExample 组件
  3. 点击播放
  4. 查看控制台和场景效果

  这样你就可以立即看到新的 Minecraft 资源包渲染系统的效果了！