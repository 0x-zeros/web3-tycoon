# Grass Block Overlay

本设计文档整理了在 **Cocos Creator 3.x** 中实现 Minecraft 风格的 `grass_block` 渲染，以及扩展在方块上绘制文字（单词、昵称、数值等）的方案。

---

## Grass Block Overlay 实现

### 基本结构

* **子网格 0：方块本体**（不透明）

  * 六个面（top / bottom / four sides）
  * 贴图：`grass_block_top`、`dirt`、`grass_block_side`
* **子网格 1：草的绿色 overlay**（透明 + tint）

  * 仅四个侧面（不含 top/bottom）
  * 贴图：`grass_block_side_overlay`
  * 属性：`tintindex = 0` → 生物群系颜色
  * 渲染：深度测试开、深度写入关、透明混合开

### 渲染要点

1. **渲染顺序**：先绘制本体，再绘制 overlay。
2. **避免 Z-Fighting**：

   * overlay 层深度写入关，或
   * 在顶点 shader 做 `u_Inflate=0.001` 的微膨胀。
3. **Tint（生物群系染色）**：

   * `u_BiomeColor` \* overlay 纹理采样色。
4. **AO/阴影**：overlay 常用 `shade=false` 效果，避免草色“发脏”。

### Cocos 实现方式

* 使用 **Mesh 两个子网格**：

  * `subMesh 0` → 基础层材质（不透明）
  * `subMesh 1` → overlay 材质（透明 + tint）
* Overlay 材质关键设置：

  * `depthTest = true`
  * `depthWrite = false`
  * `blend = alpha blend`
  * `u_BiomeColor`、`u_Inflate`


---

## 在方块上绘制文字

除了草的 overlay，还可以为方块增加 **文字层**。
### 方案 ：静态文字 → 烘焙到贴图

* 工具生成 PNG → 打入图集 → 作为方块面贴图。


---

## 与 Grass Overlay 结合

推荐用 **多子网格 + overlay 材质** 扩展：

* **子网格 0**：方块本体（不透明）
* **子网格 1**：草的绿色 overlay（透明 + tint）
* **子网格 2**：文字层（透明）

  * `u_TextTex = RenderTexture` （方案 B）
  * 或 `u_TextTex = MSDF 图集` （方案 C）

渲染顺序：**本体 → 草 overlay → 文字层**。

文字层的材质设置：

* `depthTest = true`
* `depthWrite = false`
* `blend = alpha blend`
* 可选：`u_Inflate = 0.001` 微膨胀，避免与本体重叠。
